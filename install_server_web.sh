#!/bin/bash
apt update 
apt install docker.io git -y 
systemctl enable docker
echo "create database topsecret;use topsecret;create table Persona (pid char(10), nombre char(20), f_nacim date, f_alta date,primary key (pid));insert into Persona values ('user0', 'Anthony Davis', '1998-04-24', '2003-11-20');insert into Persona values ('user1', 'Anthony King', '1977-08-06', '2002-01-04');insert into Persona values ('user2', 'Barbara Green', '1991-02-26', '2006-03-12');insert into Persona values ('user3', 'Barbara Martin', '1981-01-19', '2003-06-13');insert into Persona values ('user4', 'Barbara Wright', '1978-04-19', '2002-01-29');insert into Persona values ('user5', 'Betty Davis', '1977-12-01', '2002-03-02');insert into Persona values ('user6', 'Betty Johnson', '1985-09-03', '2003-09-16');insert into Persona values ('user7', 'Betty Rodriguez', '1969-05-14', '2003-01-24');" > base.sql
chmod 777 base.sql
echo "CREATE USER 'user'@'%' IDENTIFIED BY 'password'; GRANT ALL PRIVILEGES ON *.* TO 'user'@'%'; RENAME USER 'root'@'localhost' TO 'root'@'%';FLUSH PRIVILEGES;" > usuarios.sql
chmod 777 usuarios.sql
sudo debconf-set-selections <<< 'mysql-server mysql-server/root_password password algo'
sudo debconf-set-selections <<< 'mysql-server mysql-server/root_password_again password algo'
sudo apt-get -y install mysql-server
mysql -u root -palgo< base.sql
mysql -u root -palgo< usuarios.sql
sudo sed -i "43d" /etc/mysql/mysql.conf.d/mysqld.cnf 
sudo service mysql restart
git clone https://github.com/christophetd/log4shell-vulnerable-app.git
cd ..
cd ..
cd log4shell-vulnerable-app
sudo docker build . -t vulnerable-app
sudo docker run -p 8080:8080 --name vulnerable-app --rm vulnerable-app